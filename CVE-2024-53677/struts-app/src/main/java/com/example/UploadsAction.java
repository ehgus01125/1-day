package com.struts2;

import org.apache.commons.io.FileUtils;
import com.opensymphony.xwork2.ActionSupport;
import java.io.*;
import java.util.ArrayList;
import java.util.List;

public class UploadsAction extends ActionSupport {

    private static final long serialVersionUID = 1L;
    private List<File> upload;
    private List<String> uploadContentType;
    private List<String> uploadFileName;
    private List<String> uploadedFileNames =  new ArrayList<String>();

    public List<File> getUpload() {
        return upload;
    }

    public void setUpload(List<File> upload) {
        this.upload = upload;
    }

    public List<String> getUploadContentType() {
        return uploadContentType;
    }

    public void setUploadContentType(List<String> uploadContentType) {
        this.uploadContentType = uploadContentType;
    }

    public List<String> getUploadFileName() {
        return uploadFileName;
    }

    public void setUploadFileName(List<String> uploadFileName) {
        this.uploadFileName = uploadFileName;
    }

    public List<String> getUploadedFileNames() {
        return uploadedFileNames;
    }

    public String doUpload() {
        for (int i = 0; i < uploadFileName.size(); i++) {
                try {
                    
                    String uploadDir = "webapps/ROOT/uploads"; 
                    File uploadDirectory = new File(uploadDir);
                    
                    if (!uploadDirectory.exists()) {
                        uploadDirectory.mkdir();
                    }
        
                    File destFile = new File(uploadDirectory, uploadFileName.get(i));
        
                    FileInputStream inputStream = new FileInputStream(upload.get(i));
                    FileOutputStream outputStream = new FileOutputStream(destFile);
        
                    byte[] buffer = new byte[1024];
                    int length;
                    while ((length = inputStream.read(buffer)) > 0) {
                        outputStream.write(buffer, 0, length);
                    }
                    inputStream.close();
                    outputStream.close();
                    uploadedFileNames.add(uploadFileName.get(i));
                } catch (IOException e) {
                    addActionError("File upload failed: " + e.getMessage());
                    return ERROR;
                }
            
        }
        return SUCCESS;
    }

}

